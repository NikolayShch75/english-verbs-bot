name: English Verbs Telegram Bot

on:
  push:
    branches: [ main ]
  schedule:
    - cron: '0 */6 * * *'  # –ó–∞–ø—É—Å–∫ –∫–∞–∂–¥—ã–µ 6 —á–∞—Å–æ–≤
  workflow_dispatch:  # –†–∞–∑—Ä–µ—à–∏—Ç—å —Ä—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫

jobs:
  run-bot:
    runs-on: ubuntu-latest
    timeout-minutes: 360  # 6 —á–∞—Å–æ–≤ –º–∞–∫—Å–∏–º—É–º
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v3
      
    - name: Setup R
      uses: r-lib/actions/setup-r@v2
      with:
        r-version: '4.3'  # –£–∫–∞–∑—ã–≤–∞–µ–º –≤–µ—Ä—Å–∏—é R
      
    - name: Install system dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y libcurl4-openssl-dev libssl-dev libxml2-dev
      
    - name: Install R packages
      run: |
        R -e "install.packages(c('telegram.bot', 'dplyr', 'stringr'), repos='https://cloud.r-project.org/', quiet = FALSE)"
        R -e "if(!require(telegram.bot)) { stop('–ü–∞–∫–µ—Ç telegram.bot –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–∏–ª—Å—è') }"
        R -e "cat('‚úÖ –í—Å–µ –ø–∞–∫–µ—Ç—ã —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ\n')"
      
    - name: Run Telegram Bot
      env:
        BOT_TOKEN: ${{ secrets.BOT_TOKEN }}
      run: |
        echo "üöÄ –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞..."
        echo "–¢–æ–∫–µ–Ω: ${BOT_TOKEN:0:10}..."
        echo "–ü—Ä–æ–≤–µ—Ä—è–µ–º —É—Å—Ç–∞–Ω–æ–≤–∫—É –ø–∞–∫–µ—Ç–æ–≤..."
        R -e "library(telegram.bot); library(dplyr); library(stringr); cat('‚úÖ –ü–∞–∫–µ—Ç—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ\n')"
        echo "–ó–∞–ø—É—Å–∫–∞–µ–º –æ—Å–Ω–æ–≤–Ω—É—é –ø—Ä–æ–≥—Ä–∞–º–º—É..."
        timeout 350m Rscript bot.r
